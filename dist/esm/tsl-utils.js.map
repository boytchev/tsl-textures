{"version":3,"file":"tsl-utils.js","sources":["../../src/tsl-utils.js"],"sourcesContent":["\n//\tEquirectangular Texture Generator - TSL Utility Functions\n//\n//\thsl( h, s, l ):vec3 \t\t\t- convert from hsl to rgb\n//\ttoHsl( rgb:vec3 ):vec3\t\t\t- convert from rgb to hsl\n//\tspherical( phi, theta ):vec3\t- from angles to point on unit sphere\n//\tapplyEuler( vec:vec3, eu:vec3 ):vec3 - apply Euler rotation to a vector\n\n\n\nimport { add, cos, cross, dFdx, dFdy, float, Fn, If, log2, mat4, max, min, mul, positionGeometry, pow, remap, select, sin, smoothstep, sub, transformNormalToView, uniform, vec3, vec4 } from 'three/tsl';\nimport { Color, Vector3 } from 'three';\n//import { mx_perlin_noise_float as noise } from 'https://cdn.jsdelivr.net/npm/three@0.167.0/src/nodes/materialx/lib/mx_noise.js';\n\n\n// helper function - convert hsl to rgb, ported to TSL from:\n// https://en.wikipedia.org/wiki/HSL_and_HSV#HSL_to_RGB_alternative\n\nconst hslHelper = Fn( ([ h, s, l, n ])=>{\n\n\tvar k = n.add( h.mul( 12 ) ).mod( 12 );\n\tvar a = s.mul( min( l, sub( 1, l ) ) );\n\treturn l.sub( a.mul( max( -1, min( min( k.sub( 3 ), sub( 9, k ) ), 1 ) ) ) );\n\n} );\n\nhslHelper.setLayout( {\n\tname: 'hslHelper',\n\ttype: 'float',\n\tinputs: [\n\t\t{ name: 'h', type: 'float' },\n\t\t{ name: 's', type: 'float' },\n\t\t{ name: 'l', type: 'float' },\n\t\t{ name: 'n', type: 'float' },\n\t]\n} );\n\n\n\n// convert from hsl to rgb\nconst hsl = Fn( ([ h, s, l ]) => {\n\n\th = h.fract().add( 1 ).fract();\n\ts = s.clamp( 0, 1 );\n\tl = l.clamp( 0, 1 );\n\n\tvar r = hslHelper( h, s, l, 0 );\n\tvar g = hslHelper( h, s, l, 8 );\n\tvar b = hslHelper( h, s, l, 4 );\n\n\treturn vec3( r, g, b );\n\n} );\n\nhsl.setLayout( {\n\tname: 'hsl',\n\ttype: 'vec3',\n\tinputs: [\n\t\t{ name: 'h', type: 'float' },\n\t\t{ name: 's', type: 'float' },\n\t\t{ name: 'l', type: 'float' },\n\t]\n} );\n\n\n// convert from rgb to hsl\nconst toHsl = Fn( ([ rgb ]) => {\n\n\tvar R = float( rgb.x ).toVar(),\n\t\tG = float( rgb.y ).toVar(),\n\t\tB = float( rgb.z ).toVar();\n\n\tvar mx = max( R, max( G, B ) ).toVar();\n\tvar mn = min( R, min( G, B ) ).toVar();\n\n\tvar H = float( 0 ).toVar(),\n\t\tS = float( 0 ).toVar(),\n\t\tL = add( mx, mn ).div( 2 );\n\n\tIf( mn.notEqual( mx ), ()=>{\n\n\t\tconst delta = sub( mx, mn ).toVar();\n\n\t\tS.assign( select( L.lessThanEqual( 0.5 ), delta.div( add( mn, mx ) ), delta.div( sub( 2, add( mn, mx ) ) ) ) );\n\t\tIf( mx.equal( R ), ()=>{\n\n\t\t\tH.assign( sub( G, B ).div( delta ).add( select( G.lessThanEqual( B ), 6, 0 ) ) );\n\n\t\t} )\n\t\t\t.ElseIf( mx.equal( G ), ()=>{\n\n\t\t\t\tH.assign( sub( B, R ).div( delta ).add( 2 ) );\n\n\t\t\t} )\n\t\t\t.Else( ()=>{\n\n\t\t\t\tH.assign( sub( R, G ).div( delta ).add( 4 ) );\n\n\t\t\t} );\n\t\tH.divAssign( 6 );\n\n\t} );\n\treturn vec3( H, S, L );\n\n} );\n\n\n\n\n\n// make all elements dynamic (i.e. uniform)\nfunction dynamic( params ) {\n\n\tvar result = {};\n\n\tfor ( var [ key, value ] of Object.entries( params ) ) {\n\n\t\tif ( key[ 0 ]!='$' ) {\n\n\t\t\tif ( value instanceof Vector3 )\n\t\t\t\tresult[ key ] = uniform( value, 'vec3' );\n\t\t\telse\n\t\t\t\tresult[ key ] = uniform( value );\n\n\t\t}\n\n\t}\n\n\treturn result;\n\n}\n\n\n\n// convert phi-theta angles to position on unit sphere\nconst spherical = Fn( ([ phi, theta ]) => {\n\n\treturn vec3(\n\t\tsin( theta ).mul( sin( phi ) ),\n\t\tcos( phi ),\n\t\tcos( theta ).mul( sin( phi ) )\n\t);\n\n} );\n\nspherical.setLayout( {\n\tname: 'spherical',\n\ttype: 'vec3',\n\tinputs: [\n\t\t{ name: 'phi', type: 'float' },\n\t\t{ name: 'theta', type: 'float' },\n\t]\n} );\n\n\n\n// apply Euler rotation to a vector\nconst applyEuler = Fn( ([ vec, eu ]) => {\n\n\tvar quat = quaternionFromEuler( eu );\n\treturn applyQuaternion( vec, quat );\n\n} );\n\n\n// convert Euler XYZ angles to quaternion\nconst quaternionFromEuler = Fn( ([ eu ]) => {\n\n\tvar c1 = cos( eu.x.div( 2 ) );\n\tvar c2 = cos( eu.y.div( 2 ) );\n\tvar c3 = cos( eu.z.div( 2 ) );\n\n\tvar s1 = sin( eu.x.div( 2 ) );\n\tvar s2 = sin( eu.y.div( 2 ) );\n\tvar s3 = sin( eu.z.div( 2 ) );\n\n\treturn vec4(\n\t\tadd( mul( s1, c2, c3 ), mul( c1, s2, s3 ) ),\n\t\tsub( mul( c1, s2, c3 ), mul( s1, c2, s3 ) ),\n\t\tadd( mul( c1, c2, s3 ), mul( s1, s2, c3 ) ),\n\t\tsub( mul( c1, c2, c3 ), mul( s1, s2, s3 ) ),\n\t);\n\n} );\n\n\n// apply quaternion rotation to a vector\nconst applyQuaternion = Fn( ([ vec, quat ]) => {\n\n\tvar t = cross( quat, vec ).mul( 2 ).toVar( );\n\n\treturn add( vec, t.mul( quat.w ), cross( quat.xyz, t ) );\n\n} );\n\n\n\n// exponential version of remap\nconst remapExp = Fn( ([ x, fromMin, fromMax, toMin, toMax ]) => {\n\n\tx = remap( x, fromMin, fromMax, 0, 1 );\n\tx = pow( 2, mul( x, log2( toMax.div( toMin ) ) ).add( log2( toMin ) ) );\n\treturn x;\n\t/*\n\nfunction mapExp( x, toMin, toMax, fromMin=0, fromMax=100 ) {\n\n\tx = map( x, 0, 1, fromMin, fromMax );\n\tx = 2**( x * Math.log2( toMax/toMin ) + Math.log2( toMin ) );\n\n\treturn x;\n\n}\n*/\n\n} );\n\n\n\n// simple vector noise, vec3->float[-1,1]\nconst vnoise = Fn( ([ v ])=>{\n\n\treturn v.dot( vec3( 12.9898, 78.233, -97.5123 ) ).sin().mul( 43758.5453 ).fract().mul( 2 ).sub( 1 );\n\n} );\n\n\n\n// generate X-rotation matrix\nconst matRotX = Fn( ([ angle ])=>{\n\n\tvar\tcos = angle.cos().toVar(),\n\t\tsin = angle.sin().toVar();\n\n\treturn mat4(\n\t\t1, 0, 0, 0,\n\t\t0, cos, sin, 0,\n\t\t0, sin.negate(), cos, 0,\n\t\t0, 0, 0, 1 );\n\n} );\n\n\n\n// generate Y-rotation matrix\nconst matRotY = Fn( ([ angle ])=>{\n\n\tvar\tcos = angle.cos().toVar(),\n\t\tsin = angle.sin().toVar();\n\n\treturn mat4(\n\t\tcos, 0, sin.negate(), 0,\n\t\t0, 1, 0, 0,\n\t\tsin, 0, cos, 0,\n\t\t0, 0, 0, 1 );\n\n} );\n\n\n\n// generate Z-rotation matrix\nconst matRotZ = Fn( ([ angle ])=>{\n\n\tvar\tcos = angle.cos().toVar(),\n\t\tsin = angle.sin().toVar();\n\n\treturn mat4(\n\t\tcos, sin, 0, 0,\n\t\tsin.negate(), cos, 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1 );\n\n} );\n\n\n\n// generate YXZ rotation matrix\nconst matRotYXZ = Fn( ([ angles ])=>{\n\n\tvar RX = matRotX( angles.x ),\n\t\tRY = matRotY( angles.y ),\n\t\tRZ = matRotZ( angles.z );\n\n\treturn RY.mul( RX ).mul( RZ );\n\n} );\n\n\n\n// generate scaling matrix\nconst matScale = Fn( ([ scales ])=>{\n\n\treturn mat4(\n\t\tscales.x, 0, 0, 0,\n\t\t0, scales.y, 0, 0,\n\t\t0, 0, scales.z, 0,\n\t\t0, 0, 0, 1 );\n\n} );\n\n\n\n// generate translation matrix\nconst matTrans = Fn( ([ vector ])=>{\n\n\treturn mat4(\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\tvector.x, vector.y, vector.z, 1 );\n\n} );\n\n\nconst selectPlanar = Fn( ([ pos, selAngles, selCenter, selWidth ])=>{\n\n\t// select zone in a plane through point selCenter,\n\t// rotated according to selAngles and selWidth thick\n\t// result is [0,1] inside plane, 0 below plane, 1 above plane\n\n\t// C is projected on segment AB\n\t// result is [0,1] inside AB, 0 before A, 1 after B\n\n\t/* non-optimized version\n\tvar s = spherical(selAngles.x,selAngles.y).mul(selWidth).toVar(),\n\t\tc = pos,\n\t\ta = selCenter.sub(s.div(2)),\n\t\tb = selCenter.add(s.div(2));\n\n\tvar ca = a.sub(c),\n\t\tab = b.sub(a).toVar();\n\n\tvar caab = ca.dot(s),\n\t\tabab = ab.dot(ab);\n\n\tvar k = caab.div(abab).negate();\n\t*/\n\n\tvar s = spherical( selAngles.x, selAngles.y ).mul( selWidth ).toVar();\n\n\tvar k = selCenter.sub( s.div( 2 ) ).sub( pos ).dot( s ).div( s.dot( s ) ).negate();\n\n\treturn smoothstep( 0, 1, k );\n\n} );\n\n\n\nconst overlayPlanar = Fn( ( params )=>{\n\n\tvar zone = selectPlanar(\n\t\tpositionGeometry,\n\t\tparams.selectorAngles,\n\t\tparams.selectorCenter,\n\t\tparams.selectorWidth\n\t).sub( 0.5 ).mul( 2 ).abs().oneMinus().pow( 0.25 ).negate().mul(\n\t\tparams.selectorShow\n\t);\n\n\treturn vec3( 0, zone, zone );\n\n} );\n\n\n\nconst normalVector = Fn( ([ pos ])=>{\n\n\tvar dU = dFdx( pos ),\n\t\tdV = dFdy( pos );\n\n\treturn transformNormalToView( cross( dU, dV ).normalize() );\n\n} );\n\n\nvar banner = null;\nvar bannerCounter = 10;\nasync function showFallbackWarning( ) {\n\n\tif ( navigator.gpu != undefined ) {\n\n\t\tvar adapter = await navigator.gpu.requestAdapter();\n\t\tif ( adapter ) return;\n\n\t}\n\n\tvar html = `\n\t<div style=\"font-size:1.25em; font-weight:bold;\">PLEASE, WAIT</div>\n\t<div  style=\"font-size:0.85em; font-weight:100;\" >NO WEBGPU &mdash; TRYING WEBGL2</div>\n\t<div id=\"counter\"></div>\n\t`;\n\n\tbanner = document.createElement( 'div' );\n\tbanner.innerHTML = html;\n\n\tbanner.style.left = 'calc(50% - 8em)';\n\tbanner.style.width = '16em';\n\n\tbanner.style.fontFamily = 'Bahnschrifts, Arial';\n\tbanner.style.position = 'absolute';\n\tbanner.style.bottom = '20px';\n\tbanner.style.padding = '12px 6px';\n\tbanner.style.border = '1px solid white';\n\tbanner.style.borderRadius = '4px';\n\tbanner.style.background = 'rgba(0,0,0,0.5)';\n\tbanner.style.color = 'white';\n\tbanner.style.textAlign = 'center';\n\tbanner.style.opacity = '0.8';\n\tbanner.style.outline = 'none';\n\tbanner.style.zIndex = '999';\n\n\tdocument.body.appendChild( banner );\n\n}\n\n\n\nfunction hideFallbackWarning( ) {\n\n\tif ( banner ) {\n\n\t\tif ( bannerCounter>0 )\n\t\t\tbannerCounter--;\n\t\telse {\n\n\t\t\tbanner.style.display = 'none';\n\t\t\t//\t\tdocument.removeChild( banner );\n\t\t\tbanner = null;\n\n\t\t}\n\n\t}\n\n}\n\n\n\n// converts all numeric, color and vector properties to nodes\nfunction prepare( params ) {\n\n\tfor ( var name of Object.keys( params ) ) {\n\n\t\tif ( typeof params[ name ] === 'number' )\n\t\t\tparams[ name ] = float( params[ name ]);\n\t\telse\n\t\t\tif ( params[ name ] instanceof Color )\n\t\t\t\tparams[ name ] = vec3( params[ name ].r, params[ name ].g, params[ name ].b );\n\t\t\telse\n\t\t\t\tif ( params[ name ] instanceof Vector3 )\n\t\t\t\t\tparams[ name ] = vec3( params[ name ].x, params[ name ].y, params[ name ].z );\n\n\t}\n\n\treturn params;\n\n}\n\n\n\n\nexport\n{\n\tmx_noise_float as noise\n} from 'three/tsl';\n\nexport\n{\n\tvnoise,\n\thsl,\n\ttoHsl,\n\tdynamic,\n\tspherical,\n\tapplyEuler,\n\tremapExp,\n\tmatRotX,\n\tmatRotY,\n\tmatRotZ,\n\tmatRotYXZ,\n\tmatTrans,\n\tmatScale,\n\tselectPlanar,\n\toverlayPlanar,\n\tshowFallbackWarning,\n\thideFallbackWarning,\n\tnormalVector,\n\tprepare\n};\n"],"names":["hslHelper","Fn","h","s","l","n","k","add","mul","mod","a","min","sub","max","setLayout","name","type","inputs","hsl","fract","clamp","r","g","b","vec3","toHsl","rgb","R","float","x","toVar","G","y","B","z","mx","mn","H","S","L","div","If","notEqual","delta","assign","select","lessThanEqual","equal","ElseIf","Else","divAssign","dynamic","params","result","key","value","Object","entries","Vector3","uniform","spherical","phi","theta","sin","cos","applyEuler","vec","eu","quat","quaternionFromEuler","applyQuaternion","c1","c2","c3","s1","s2","s3","vec4","t","cross","w","xyz","remapExp","fromMin","fromMax","toMin","toMax","remap","pow","log2","vnoise","v","dot","matRotX","angle","mat4","negate","matRotY","matRotZ","matRotYXZ","angles","RX","RY","RZ","matScale","scales","matTrans","vector","selectPlanar","pos","selAngles","selCenter","selWidth","smoothstep","overlayPlanar","zone","positionGeometry","selectorAngles","selectorCenter","selectorWidth","abs","oneMinus","selectorShow","normalVector","dU","dFdx","dV","dFdy","transformNormalToView","normalize","banner","bannerCounter","async","showFallbackWarning","undefined","navigator","gpu","requestAdapter","document","createElement","innerHTML","style","left","width","fontFamily","position","bottom","padding","border","borderRadius","background","color","textAlign","opacity","outline","zIndex","body","appendChild","hideFallbackWarning","display","prepare","keys","Color"],"mappings":"gYAkBA,MAAMA,EAAYC,GAAI,EAAGC,EAAGC,EAAGC,EAAGC,MAEjC,IAAIC,EAAID,EAAEE,IAAKL,EAAEM,IAAK,KAAOC,IAAK,IAC9BC,EAAIP,EAAEK,IAAKG,EAAKP,EAAGQ,EAAK,EAAGR,KAC/B,OAAOA,EAAEQ,IAAKF,EAAEF,IAAKK,GAAO,EAAEF,EAAKA,EAAKL,EAAEM,IAAK,GAAKA,EAAK,EAAGN,IAAO,KAAS,IAI7EN,EAAUc,UAAW,CACpBC,KAAM,YACNC,KAAM,QACNC,OAAQ,CACP,CAAEF,KAAM,IAAKC,KAAM,SACnB,CAAED,KAAM,IAAKC,KAAM,SACnB,CAAED,KAAM,IAAKC,KAAM,SACnB,CAAED,KAAM,IAAKC,KAAM,YAOhB,MAACE,EAAMjB,GAAI,EAAGC,EAAGC,EAAGC,MAExBF,EAAIA,EAAEiB,QAAQZ,IAAK,GAAIY,QACvBhB,EAAIA,EAAEiB,MAAO,EAAG,GAChBhB,EAAIA,EAAEgB,MAAO,EAAG,GAEhB,IAAIC,EAAIrB,EAAWE,EAAGC,EAAGC,EAAG,GACxBkB,EAAItB,EAAWE,EAAGC,EAAGC,EAAG,GACxBmB,EAAIvB,EAAWE,EAAGC,EAAGC,EAAG,GAE5B,OAAOoB,EAAMH,EAAGC,EAAGC,EAAG,IAIvBL,EAAIJ,UAAW,CACdC,KAAM,MACNC,KAAM,OACNC,OAAQ,CACP,CAAEF,KAAM,IAAKC,KAAM,SACnB,CAAED,KAAM,IAAKC,KAAM,SACnB,CAAED,KAAM,IAAKC,KAAM,YAMhB,MAACS,EAAQxB,GAAI,EAAGyB,MAEpB,IAAIC,EAAIC,EAAOF,EAAIG,GAAIC,QACtBC,EAAIH,EAAOF,EAAIM,GAAIF,QACnBG,EAAIL,EAAOF,EAAIQ,GAAIJ,QAEhBK,EAAKtB,EAAKc,EAAGd,EAAKkB,EAAGE,IAAMH,QAC3BM,EAAKzB,EAAKgB,EAAGhB,EAAKoB,EAAGE,IAAMH,QAE3BO,EAAIT,EAAO,GAAIE,QAClBQ,EAAIV,EAAO,GAAIE,QACfS,EAAIhC,EAAK4B,EAAIC,GAAKI,IAAK,GAyBxB,OAvBAC,EAAIL,EAAGM,SAAUP,IAAM,KAEtB,MAAMQ,EAAQ/B,EAAKuB,EAAIC,GAAKN,QAE5BQ,EAAEM,OAAQC,EAAQN,EAAEO,cAAe,IAAOH,EAAMH,IAAKjC,EAAK6B,EAAID,IAAQQ,EAAMH,IAAK5B,EAAK,EAAGL,EAAK6B,EAAID,OAClGM,EAAIN,EAAGY,MAAOpB,IAAK,KAElBU,EAAEO,OAAQhC,EAAKmB,EAAGE,GAAIO,IAAKG,GAAQpC,IAAKsC,EAAQd,EAAEe,cAAeb,GAAK,EAAG,IAAO,IAG/Ee,OAAQb,EAAGY,MAAOhB,IAAK,KAEvBM,EAAEO,OAAQhC,EAAKqB,EAAGN,GAAIa,IAAKG,GAAQpC,IAAK,GAAK,IAG7C0C,MAAM,KAENZ,EAAEO,OAAQhC,EAAKe,EAAGI,GAAIS,IAAKG,GAAQpC,IAAK,GAAK,IAG/C8B,EAAEa,UAAW,EAAG,IAGV1B,EAAMa,EAAGC,EAAGC,EAAG,IASvB,SAASY,EAASC,GAEjB,IAAIC,EAAS,CAAE,EAEf,IAAM,IAAMC,EAAKC,KAAWC,OAAOC,QAASL,GAE5B,KAAVE,EAAK,KAGRD,EAAQC,GADJC,aAAiBG,EACLC,EAASJ,EAAO,QAEhBI,EAASJ,IAM5B,OAAOF,CAER,CAKK,MAACO,EAAY3D,GAAI,EAAG4D,EAAKC,KAEtBtC,EACNuC,EAAKD,GAAQtD,IAAKuD,EAAKF,IACvBG,EAAKH,GACLG,EAAKF,GAAQtD,IAAKuD,EAAKF,OAKzBD,EAAU9C,UAAW,CACpBC,KAAM,YACNC,KAAM,OACNC,OAAQ,CACP,CAAEF,KAAM,MAAOC,KAAM,SACrB,CAAED,KAAM,QAASC,KAAM,YAOpB,MAACiD,EAAahE,GAAI,EAAGiE,EAAKC,MAE9B,IAAIC,EAAOC,EAAqBF,GAChC,OAAOG,EAAiBJ,EAAKE,EAAM,IAM9BC,EAAsBpE,GAAI,EAAGkE,MAElC,IAAII,EAAKP,EAAKG,EAAGtC,EAAEW,IAAK,IACpBgC,EAAKR,EAAKG,EAAGnC,EAAEQ,IAAK,IACpBiC,EAAKT,EAAKG,EAAGjC,EAAEM,IAAK,IAEpBkC,EAAKX,EAAKI,EAAGtC,EAAEW,IAAK,IACpBmC,EAAKZ,EAAKI,EAAGnC,EAAEQ,IAAK,IACpBoC,EAAKb,EAAKI,EAAGjC,EAAEM,IAAK,IAExB,OAAOqC,EACNtE,EAAKC,EAAKkE,EAAIF,EAAIC,GAAMjE,EAAK+D,EAAII,EAAIC,IACrChE,EAAKJ,EAAK+D,EAAII,EAAIF,GAAMjE,EAAKkE,EAAIF,EAAII,IACrCrE,EAAKC,EAAK+D,EAAIC,EAAII,GAAMpE,EAAKkE,EAAIC,EAAIF,IACrC7D,EAAKJ,EAAK+D,EAAIC,EAAIC,GAAMjE,EAAKkE,EAAIC,EAAIC,IACrC,IAMIN,EAAkBrE,GAAI,EAAGiE,EAAKE,MAEnC,IAAIU,EAAIC,EAAOX,EAAMF,GAAM1D,IAAK,GAAIsB,QAEpC,OAAOvB,EAAK2D,EAAKY,EAAEtE,IAAK4D,EAAKY,GAAKD,EAAOX,EAAKa,IAAKH,GAAK,IAOnDI,EAAWjF,GAAI,EAAG4B,EAAGsD,EAASC,EAASC,EAAOC,MAEnDzD,EAAI0D,EAAO1D,EAAGsD,EAASC,EAAS,EAAG,GACnCvD,EAAI2D,EAAK,EAAGhF,EAAKqB,EAAG4D,EAAMH,EAAM9C,IAAK6C,KAAY9E,IAAKkF,EAAMJ,QAmBvDK,EAASzF,GAAI,EAAG0F,KAEdA,EAAEC,IAAKpE,EAAM,QAAS,QAAQ,UAAauC,MAAMvD,IAAK,YAAaW,QAAQX,IAAK,GAAII,IAAK,KAO3FiF,EAAU5F,GAAI,EAAG6F,MAEtB,IAAI9B,EAAM8B,EAAM9B,MAAMlC,QACrBiC,EAAM+B,EAAM/B,MAAMjC,QAEnB,OAAOiE,EACN,EAAG,EAAG,EAAG,EACT,EAAG/B,EAAKD,EAAK,EACb,EAAGA,EAAIiC,SAAUhC,EAAK,EACtB,EAAG,EAAG,EAAG,EAAG,IAORiC,EAAUhG,GAAI,EAAG6F,MAEtB,IAAI9B,EAAM8B,EAAM9B,MAAMlC,QACrBiC,EAAM+B,EAAM/B,MAAMjC,QAEnB,OAAOiE,EACN/B,EAAK,EAAGD,EAAIiC,SAAU,EACtB,EAAG,EAAG,EAAG,EACTjC,EAAK,EAAGC,EAAK,EACb,EAAG,EAAG,EAAG,EAAG,IAORkC,EAAUjG,GAAI,EAAG6F,MAEtB,IAAI9B,EAAM8B,EAAM9B,MAAMlC,QACrBiC,EAAM+B,EAAM/B,MAAMjC,QAEnB,OAAOiE,EACN/B,EAAKD,EAAK,EAAG,EACbA,EAAIiC,SAAUhC,EAAK,EAAG,EACtB,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EAAG,IAORmC,EAAYlG,GAAI,EAAGmG,MAExB,IAAIC,EAAKR,EAASO,EAAOvE,GACxByE,EAAKL,EAASG,EAAOpE,GACrBuE,EAAKL,EAASE,EAAOlE,GAEtB,OAAOoE,EAAG9F,IAAK6F,GAAK7F,IAAK+F,EAAI,IAOxBC,EAAWvG,GAAI,EAAGwG,KAEhBV,EACNU,EAAO5E,EAAG,EAAG,EAAG,EAChB,EAAG4E,EAAOzE,EAAG,EAAG,EAChB,EAAG,EAAGyE,EAAOvE,EAAG,EAChB,EAAG,EAAG,EAAG,KAOLwE,EAAWzG,GAAI,EAAG0G,KAEhBZ,EACN,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACT,EAAG,EAAG,EAAG,EACTY,EAAO9E,EAAG8E,EAAO3E,EAAG2E,EAAOzE,EAAG,KAK1B0E,EAAe3G,GAAI,EAAG4G,EAAKC,EAAWC,EAAWC,MAwBtD,IAAI7G,EAAIyD,EAAWkD,EAAUjF,EAAGiF,EAAU9E,GAAIxB,IAAKwG,GAAWlF,QAE1DxB,EAAIyG,EAAUnG,IAAKT,EAAEqC,IAAK,IAAM5B,IAAKiG,GAAMjB,IAAKzF,GAAIqC,IAAKrC,EAAEyF,IAAKzF,IAAM6F,SAE1E,OAAOiB,EAAY,EAAG,EAAG3G,EAAG,IAMvB4G,EAAgBjH,GAAMmD,IAE3B,IAAI+D,EAAOP,EACVQ,EACAhE,EAAOiE,eACPjE,EAAOkE,eACPlE,EAAOmE,eACN3G,IAAK,IAAMJ,IAAK,GAAIgH,MAAMC,WAAWjC,IAAK,KAAOQ,SAASxF,IAC3D4C,EAAOsE,cAGR,OAAOlG,EAAM,EAAG2F,EAAMA,EAAM,IAMvBQ,EAAe1H,GAAI,EAAG4G,MAE3B,IAAIe,EAAKC,EAAMhB,GACdiB,EAAKC,EAAMlB,GAEZ,OAAOmB,EAAuBjD,EAAO6C,EAAIE,GAAKG,YAAa,IAK5D,IAAIC,EAAS,KACTC,EAAgB,GACpBC,eAAeC,IAEd,GAAsBC,MAAjBC,UAAUC,WAEMD,UAAUC,IAAIC,iBACnB,QAUhBP,EAASQ,SAASC,cAAe,QAC1BC,UAPI,qMASXV,EAAOW,MAAMC,KAAO,kBACpBZ,EAAOW,MAAME,MAAQ,OAErBb,EAAOW,MAAMG,WAAa,sBAC1Bd,EAAOW,MAAMI,SAAW,WACxBf,EAAOW,MAAMK,OAAS,OACtBhB,EAAOW,MAAMM,QAAU,WACvBjB,EAAOW,MAAMO,OAAS,kBACtBlB,EAAOW,MAAMQ,aAAe,MAC5BnB,EAAOW,MAAMS,WAAa,kBAC1BpB,EAAOW,MAAMU,MAAQ,QACrBrB,EAAOW,MAAMW,UAAY,SACzBtB,EAAOW,MAAMY,QAAU,MACvBvB,EAAOW,MAAMa,QAAU,OACvBxB,EAAOW,MAAMc,OAAS,MAEtBjB,SAASkB,KAAKC,YAAa3B,EAE5B,CAIA,SAAS4B,IAEH5B,IAECC,EAAc,EAClBA,KAGAD,EAAOW,MAAMkB,QAAU,OAEvB7B,EAAS,MAMZ,CAKA,SAAS8B,EAAS5G,GAEjB,IAAM,IAAIrC,KAAQyC,OAAOyG,KAAM7G,GAEC,iBAAnBA,EAAQrC,GACnBqC,EAAQrC,GAASa,EAAOwB,EAAQrC,IAE3BqC,EAAQrC,aAAkBmJ,EAC9B9G,EAAQrC,GAASS,EAAM4B,EAAQrC,GAAOM,EAAG+B,EAAQrC,GAAOO,EAAG8B,EAAQrC,GAAOQ,GAErE6B,EAAQrC,aAAkB2C,IAC9BN,EAAQrC,GAASS,EAAM4B,EAAQrC,GAAOc,EAAGuB,EAAQrC,GAAOiB,EAAGoB,EAAQrC,GAAOmB,IAI9E,OAAOkB,CAER"}