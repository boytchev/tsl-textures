{"version":3,"file":"tsl-utils.js","sources":["../../src/tsl-utils.js"],"sourcesContent":["\n//\tEquirectangular Texture Generator - TSL Utility Functions\n//\n//\thsl( h, s, l ):vec3 \t\t\t- convert from hsl to rgb\n//\ttoHsl( rgb:vec3 ):vec3\t\t\t- convert from rgb to hsl\n//\tspherical( phi, theta ):vec3\t- from angles to point on unit sphere\n//\tapplyEuler( vec:vec3, eu:vec3 ):vec3 - apply Euler rotation to a vector\n\n\n\nimport { add, cos, cross, dFdx, dFdy, float, Fn, If, log2, mat4, max, min, mul, positionGeometry, pow, remap, select, sin, smoothstep, sub, transformNormalToView, uniform, vec3, vec4 } from 'three/tsl';\nimport { Color, Vector3 } from 'three';\n//import { mx_perlin_noise_float as noise } from 'https://cdn.jsdelivr.net/npm/three@0.167.0/src/nodes/materialx/lib/mx_noise.js';\n\n\n// helper function - convert hsl to rgb, ported to TSL from:\n// https://en.wikipedia.org/wiki/HSL_and_HSV#HSL_to_RGB_alternative\n\nconst hslHelper = Fn( ([ h, s, l, n ])=>{\n\n\tvar k = n.add( h.mul( 12 ) ).mod( 12 );\n\tvar a = s.mul( min( l, sub( 1, l ) ) );\n\treturn l.sub( a.mul( max( -1, min( min( k.sub( 3 ), sub( 9, k ) ), 1 ) ) ) );\n\n} );\n\nhslHelper.setLayout( {\n\tname: 'hslHelper',\n\ttype: 'float',\n\tinputs: [\n\t\t{ name: 'h', type: 'float' },\n\t\t{ name: 's', type: 'float' },\n\t\t{ name: 'l', type: 'float' },\n\t\t{ name: 'n', type: 'float' },\n\t]\n} );\n\n\n\n// convert from hsl to rgb\nconst hsl = Fn( ([ h, s, l ]) => {\n\n\th = h.fract().add( 1 ).fract();\n\ts = s.clamp( 0, 1 );\n\tl = l.clamp( 0, 1 );\n\n\tvar r = hslHelper( h, s, l, 0 );\n\tvar g = hslHelper( h, s, l, 8 );\n\tvar b = hslHelper( h, s, l, 4 );\n\n\treturn vec3( r, g, b );\n\n} );\n\nhsl.setLayout( {\n\tname: 'hsl',\n\ttype: 'vec3',\n\tinputs: [\n\t\t{ name: 'h', type: 'float' },\n\t\t{ name: 's', type: 'float' },\n\t\t{ name: 'l', type: 'float' },\n\t]\n} );\n\n\n// convert from rgb to hsl\nconst toHsl = Fn( ([ rgb ]) => {\n\n\tvar R = float( rgb.x ).toVar(),\n\t\tG = float( rgb.y ).toVar(),\n\t\tB = float( rgb.z ).toVar();\n\n\tvar mx = max( R, max( G, B ) ).toVar();\n\tvar mn = min( R, min( G, B ) ).toVar();\n\n\tvar H = float( 0 ).toVar(),\n\t\tS = float( 0 ).toVar(),\n\t\tL = add( mx, mn ).div( 2 );\n\n\tIf( mn.notEqual( mx ), ()=>{\n\n\t\tconst delta = sub( mx, mn ).toVar();\n\n\t\tS.assign( select( L.lessThanEqual( 0.5 ), delta.div( add( mn, mx ) ), delta.div( sub( 2, add( mn, mx ) ) ) ) );\n\t\tIf( mx.equal( R ), ()=>{\n\n\t\t\tH.assign( sub( G, B ).div( delta ).add( select( G.lessThanEqual( B ), 6, 0 ) ) );\n\n\t\t} )\n\t\t\t.ElseIf( mx.equal( G ), ()=>{\n\n\t\t\t\tH.assign( sub( B, R ).div( delta ).add( 2 ) );\n\n\t\t\t} )\n\t\t\t.Else( ()=>{\n\n\t\t\t\tH.assign( sub( R, G ).div( delta ).add( 4 ) );\n\n\t\t\t} );\n\t\tH.divAssign( 6 );\n\n\t} );\n\treturn vec3( H, S, L );\n\n} );\n\n\n\n\n\n// make all elements dynamic (i.e. uniform)\nfunction dynamic( params ) {\n\n\tvar result = {};\n\n\tfor ( var [ key, value ] of Object.entries( params ) ) {\n\n\t\tif ( key[ 0 ]!='$' ) {\n\n\t\t\tif ( value instanceof Vector3 )\n\t\t\t\tresult[ key ] = uniform( value, 'vec3' );\n\t\t\telse\n\t\t\t\tresult[ key ] = uniform( value );\n\n\t\t}\n\n\t}\n\n\treturn result;\n\n}\n\n\n\n// convert phi-theta angles to position on unit sphere\nconst spherical = Fn( ([ phi, theta ]) => {\n\n\treturn vec3(\n\t\tsin( theta ).mul( sin( phi ) ),\n\t\tcos( phi ),\n\t\tcos( theta ).mul( sin( phi ) )\n\t);\n\n} );\n\nspherical.setLayout( {\n\tname: 'spherical',\n\ttype: 'vec3',\n\tinputs: [\n\t\t{ name: 'phi', type: 'float' },\n\t\t{ name: 'theta', type: 'float' },\n\t]\n} );\n\n\n\n// apply Euler rotation to a vector\nconst applyEuler = Fn( ([ vec, eu ]) => {\n\n\tvar quat = quaternionFromEuler( eu );\n\treturn applyQuaternion( vec, quat );\n\n} );\n\n\n// convert Euler XYZ angles to quaternion\nconst quaternionFromEuler = Fn( ([ eu ]) => {\n\n\tvar c1 = cos( eu.x.div( 2 ) );\n\tvar c2 = cos( eu.y.div( 2 ) );\n\tvar c3 = cos( eu.z.div( 2 ) );\n\n\tvar s1 = sin( eu.x.div( 2 ) );\n\tvar s2 = sin( eu.y.div( 2 ) );\n\tvar s3 = sin( eu.z.div( 2 ) );\n\n\treturn vec4(\n\t\tadd( mul( s1, c2, c3 ), mul( c1, s2, s3 ) ),\n\t\tsub( mul( c1, s2, c3 ), mul( s1, c2, s3 ) ),\n\t\tadd( mul( c1, c2, s3 ), mul( s1, s2, c3 ) ),\n\t\tsub( mul( c1, c2, c3 ), mul( s1, s2, s3 ) ),\n\t);\n\n} );\n\n\n// apply quaternion rotation to a vector\nconst applyQuaternion = Fn( ([ vec, quat ]) => {\n\n\tvar t = cross( quat, vec ).mul( 2 ).toVar( );\n\n\treturn add( vec, t.mul( quat.w ), cross( quat.xyz, t ) );\n\n} );\n\n\n\n// exponential version of remap\nconst remapExp = Fn( ([ x, fromMin, fromMax, toMin, toMax ]) => {\n\n\tx = remap( x, fromMin, fromMax, 0, 1 );\n\tx = pow( 2, mul( x, log2( toMax.div( toMin ) ) ).add( log2( toMin ) ) );\n\treturn x;\n\t/*\n\nfunction mapExp( x, toMin, toMax, fromMin=0, fromMax=100 ) {\n\n\tx = map( x, 0, 1, fromMin, fromMax );\n\tx = 2**( x * Math.log2( toMax/toMin ) + Math.log2( toMin ) );\n\n\treturn x;\n\n}\n*/\n\n} );\n\n\n\n// simple vector noise, vec3->float[-1,1]\nconst vnoise = Fn( ([ v ])=>{\n\n\treturn v.dot( vec3( 12.9898, 78.233, -97.5123 ) ).sin().mul( 43758.5453 ).fract().mul( 2 ).sub( 1 );\n\n} );\n\n\n\n// generate X-rotation matrix\nconst matRotX = Fn( ([ angle ])=>{\n\n\tvar\tcos = angle.cos().toVar(),\n\t\tsin = angle.sin().toVar();\n\n\treturn mat4(\n\t\t1, 0, 0, 0,\n\t\t0, cos, sin, 0,\n\t\t0, sin.negate(), cos, 0,\n\t\t0, 0, 0, 1 );\n\n} );\n\n\n\n// generate Y-rotation matrix\nconst matRotY = Fn( ([ angle ])=>{\n\n\tvar\tcos = angle.cos().toVar(),\n\t\tsin = angle.sin().toVar();\n\n\treturn mat4(\n\t\tcos, 0, sin.negate(), 0,\n\t\t0, 1, 0, 0,\n\t\tsin, 0, cos, 0,\n\t\t0, 0, 0, 1 );\n\n} );\n\n\n\n// generate Z-rotation matrix\nconst matRotZ = Fn( ([ angle ])=>{\n\n\tvar\tcos = angle.cos().toVar(),\n\t\tsin = angle.sin().toVar();\n\n\treturn mat4(\n\t\tcos, sin, 0, 0,\n\t\tsin.negate(), cos, 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1 );\n\n} );\n\n\n\n// generate YXZ rotation matrix\nconst matRotYXZ = Fn( ([ angles ])=>{\n\n\tvar RX = matRotX( angles.x ),\n\t\tRY = matRotY( angles.y ),\n\t\tRZ = matRotZ( angles.z );\n\n\treturn RY.mul( RX ).mul( RZ );\n\n} );\n\n\n\n// generate scaling matrix\nconst matScale = Fn( ([ scales ])=>{\n\n\treturn mat4(\n\t\tscales.x, 0, 0, 0,\n\t\t0, scales.y, 0, 0,\n\t\t0, 0, scales.z, 0,\n\t\t0, 0, 0, 1 );\n\n} );\n\n\n\n// generate translation matrix\nconst matTrans = Fn( ([ vector ])=>{\n\n\treturn mat4(\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\tvector.x, vector.y, vector.z, 1 );\n\n} );\n\n\nconst selectPlanar = Fn( ([ pos, selAngles, selCenter, selWidth ])=>{\n\n\t// select zone in a plane through point selCenter,\n\t// rotated according to selAngles and selWidth thick\n\t// result is [0,1] inside plane, 0 below plane, 1 above plane\n\n\t// C is projected on segment AB\n\t// result is [0,1] inside AB, 0 before A, 1 after B\n\n\t/* non-optimized version\n\tvar s = spherical(selAngles.x,selAngles.y).mul(selWidth).toVar(),\n\t\tc = pos,\n\t\ta = selCenter.sub(s.div(2)),\n\t\tb = selCenter.add(s.div(2));\n\n\tvar ca = a.sub(c),\n\t\tab = b.sub(a).toVar();\n\n\tvar caab = ca.dot(s),\n\t\tabab = ab.dot(ab);\n\n\tvar k = caab.div(abab).negate();\n\t*/\n\n\tvar s = spherical( selAngles.x, selAngles.y ).mul( selWidth ).toVar();\n\n\tvar k = selCenter.sub( s.div( 2 ) ).sub( pos ).dot( s ).div( s.dot( s ) ).negate();\n\n\treturn smoothstep( 0, 1, k );\n\n} );\n\n\n\nconst overlayPlanar = Fn( ( params )=>{\n\n\tvar zone = selectPlanar(\n\t\tpositionGeometry,\n\t\tparams.selectorAngles,\n\t\tparams.selectorCenter,\n\t\tparams.selectorWidth\n\t).sub( 0.5 ).mul( 2 ).abs().oneMinus().pow( 0.25 ).negate().mul(\n\t\tparams.selectorShow\n\t);\n\n\treturn vec3( 0, zone, zone );\n\n} );\n\n\n\nconst normalVector = Fn( ([ pos ])=>{\n\n\tvar dU = dFdx( pos ),\n\t\tdV = dFdy( pos );\n\n\treturn transformNormalToView( cross( dU, dV ).normalize() );\n\n} );\n\n\nvar banner = null;\nvar bannerCounter = 10;\nasync function showFallbackWarning( ) {\n\n\tif ( navigator.gpu != undefined ) {\n\n\t\tvar adapter = await navigator.gpu.requestAdapter();\n\t\tif ( adapter ) return;\n\n\t}\n\n\tvar html = `\n\t<div style=\"font-size:1.25em; font-weight:bold;\">PLEASE, WAIT</div>\n\t<div  style=\"font-size:0.85em; font-weight:100;\" >NO WEBGPU &mdash; TRYING WEBGL2</div>\n\t<div id=\"counter\"></div>\n\t`;\n\n\tbanner = document.createElement( 'div' );\n\tbanner.innerHTML = html;\n\n\tbanner.style.left = 'calc(50% - 8em)';\n\tbanner.style.width = '16em';\n\n\tbanner.style.fontFamily = 'Bahnschrifts, Arial';\n\tbanner.style.position = 'absolute';\n\tbanner.style.bottom = '20px';\n\tbanner.style.padding = '12px 6px';\n\tbanner.style.border = '1px solid white';\n\tbanner.style.borderRadius = '4px';\n\tbanner.style.background = 'rgba(0,0,0,0.5)';\n\tbanner.style.color = 'white';\n\tbanner.style.textAlign = 'center';\n\tbanner.style.opacity = '0.8';\n\tbanner.style.outline = 'none';\n\tbanner.style.zIndex = '999';\n\n\tdocument.body.appendChild( banner );\n\n}\n\n\n\nfunction hideFallbackWarning( ) {\n\n\tif ( banner ) {\n\n\t\tif ( bannerCounter>0 )\n\t\t\tbannerCounter--;\n\t\telse {\n\n\t\t\tbanner.style.display = 'none';\n\t\t\t//\t\tdocument.removeChild( banner );\n\t\t\tbanner = null;\n\n\t\t}\n\n\t}\n\n}\n\n\n\n// converts all numeric, color and vector properties to nodes\nfunction prepare( params ) {\n\n\tfor ( var name of Object.keys( params ) ) {\n\n\t\tif ( typeof params[ name ] === 'number' )\n\t\t\tparams[ name ] = float( params[ name ]);\n\t\telse\n\t\t\tif ( params[ name ] instanceof Color )\n\t\t\t\tparams[ name ] = vec3( params[ name ].r, params[ name ].g, params[ name ].b );\n\t\t\telse\n\t\t\t\tif ( params[ name ] instanceof Vector3 )\n\t\t\t\t\tparams[ name ] = vec3( params[ name ].x, params[ name ].y, params[ name ].z );\n\n\t}\n\n\treturn params;\n\n}\n\n\n\n\nexport\n{\n\tmx_noise_float as noise\n} from 'three/tsl';\n\nexport\n{\n\tvnoise,\n\thsl,\n\ttoHsl,\n\tdynamic,\n\tspherical,\n\tapplyEuler,\n\tremapExp,\n\tmatRotX,\n\tmatRotY,\n\tmatRotZ,\n\tmatRotYXZ,\n\tmatTrans,\n\tmatScale,\n\tselectPlanar,\n\toverlayPlanar,\n\tshowFallbackWarning,\n\thideFallbackWarning,\n\tnormalVector,\n\tprepare\n};\n"],"names":["hslHelper","Fn","h","s","l","n","k","add","mul","mod","a","min","sub","max","setLayout","name","type","inputs","hsl","fract","clamp","r","g","b","vec3","toHsl","rgb","R","float","x","toVar","G","y","B","z","mx","mn","H","S","L","div","If","notEqual","delta","assign","select","lessThanEqual","equal","ElseIf","Else","divAssign","spherical","phi","theta","sin","cos","applyEuler","vec","eu","quat","quaternionFromEuler","applyQuaternion","c1","c2","c3","s1","s2","s3","vec4","t","cross","w","xyz","remapExp","fromMin","fromMax","toMin","toMax","remap","pow","log2","vnoise","v","dot","matRotX","angle","mat4","negate","matRotY","matRotZ","matRotYXZ","angles","RX","RY","RZ","matScale","scales","matTrans","vector","selectPlanar","pos","selAngles","selCenter","selWidth","smoothstep","overlayPlanar","params","zone","positionGeometry","selectorAngles","selectorCenter","selectorWidth","abs","oneMinus","selectorShow","normalVector","dU","dFdx","dV","dFdy","transformNormalToView","normalize","banner","bannerCounter","result","key","value","Object","entries","Vector3","uniform","style","display","keys","Color","async","undefined","navigator","gpu","requestAdapter","document","createElement","innerHTML","left","width","fontFamily","position","bottom","padding","border","borderRadius","background","color","textAlign","opacity","outline","zIndex","body","appendChild"],"mappings":"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"}